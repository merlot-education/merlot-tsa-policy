openapi: 3.0.3
info:
    title: Policy Service
    description: The policy service exposes HTTP API for executing policies.
    version: "1.0"
servers:
    - url: http://localhost:8081
      description: Policy Server
paths:
    /liveness:
        get:
            tags:
                - health
            summary: Liveness health
            operationId: health#Liveness
            responses:
                "200":
                    description: OK response.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/HealthResponse'
                            example:
                                service: Corporis est rem.
                                status: Totam officia necessitatibus tempore nulla animi.
                                version: Consequatur vel rerum rem ipsam nam.
    /policy/{repository}/{group}/{policyName}/{version}/evaluation:
        get:
            tags:
                - policy
            summary: Evaluate policy
            description: Evaluate executes a policy with the given 'data' as input.
            operationId: policy#Evaluate#1
            parameters:
                - name: repository
                  in: path
                  description: Policy repository.
                  required: true
                  schema:
                    type: string
                    description: Policy repository.
                    example: policies
                  example: policies
                - name: group
                  in: path
                  description: Policy group.
                  required: true
                  schema:
                    type: string
                    description: Policy group.
                    example: example
                  example: example
                - name: policyName
                  in: path
                  description: Policy name.
                  required: true
                  schema:
                    type: string
                    description: Policy name.
                    example: example
                  example: example
                - name: version
                  in: path
                  description: Policy version.
                  required: true
                  schema:
                    type: string
                    description: Policy version.
                    example: "1.0"
                  example: "1.0"
                - name: x-evaluation-id
                  in: header
                  description: EvaluationID allows overwriting the randomly generated evaluationID
                  allowEmptyValue: true
                  schema:
                    type: string
                    description: EvaluationID allows overwriting the randomly generated evaluationID
                    example: did:web:example.com
                  example: did:web:example.com
                - name: x-cache-ttl
                  in: header
                  description: Policy result cache TTL in seconds
                  allowEmptyValue: true
                  schema:
                    type: integer
                    description: Policy result cache TTL in seconds
                    example: 60
                    format: int64
                  example: 60
            requestBody:
                description: Input data passed to the policy execution runtime.
                required: true
                content:
                    application/json:
                        schema:
                            type: string
                            description: Input data passed to the policy execution runtime.
                            example: Rerum asperiores nulla.
                            format: binary
                        example: Eos nemo repudiandae.
            responses:
                "200":
                    description: OK response.
                    headers:
                        ETag:
                            description: ETag contains unique identifier of the policy evaluation and can be used to later retrieve the results from Cache.
                            required: true
                            schema:
                                type: string
                                description: ETag contains unique identifier of the policy evaluation and can be used to later retrieve the results from Cache.
                                example: Eveniet voluptas rerum.
                            example: Consequatur aut ipsam.
                    content:
                        application/json:
                            schema:
                                type: string
                                description: Arbitrary JSON response.
                                example: Tenetur rerum necessitatibus fugit.
                                format: binary
                            example: Aut provident ducimus vero adipisci nemo.
        post:
            tags:
                - policy
            summary: Evaluate policy
            description: Evaluate executes a policy with the given 'data' as input.
            operationId: policy#Evaluate#2
            parameters:
                - name: repository
                  in: path
                  description: Policy repository.
                  required: true
                  schema:
                    type: string
                    description: Policy repository.
                    example: policies
                  example: policies
                - name: group
                  in: path
                  description: Policy group.
                  required: true
                  schema:
                    type: string
                    description: Policy group.
                    example: example
                  example: example
                - name: policyName
                  in: path
                  description: Policy name.
                  required: true
                  schema:
                    type: string
                    description: Policy name.
                    example: example
                  example: example
                - name: version
                  in: path
                  description: Policy version.
                  required: true
                  schema:
                    type: string
                    description: Policy version.
                    example: "1.0"
                  example: "1.0"
                - name: x-evaluation-id
                  in: header
                  description: EvaluationID allows overwriting the randomly generated evaluationID
                  allowEmptyValue: true
                  schema:
                    type: string
                    description: EvaluationID allows overwriting the randomly generated evaluationID
                    example: did:web:example.com
                  example: did:web:example.com
                - name: x-cache-ttl
                  in: header
                  description: Policy result cache TTL in seconds
                  allowEmptyValue: true
                  schema:
                    type: integer
                    description: Policy result cache TTL in seconds
                    example: 60
                    format: int64
                  example: 60
            requestBody:
                description: Input data passed to the policy execution runtime.
                required: true
                content:
                    application/json:
                        schema:
                            type: string
                            description: Input data passed to the policy execution runtime.
                            example: Rerum asperiores nulla.
                            format: binary
                        example: Itaque laborum.
            responses:
                "200":
                    description: OK response.
                    headers:
                        ETag:
                            description: ETag contains unique identifier of the policy evaluation and can be used to later retrieve the results from Cache.
                            required: true
                            schema:
                                type: string
                                description: ETag contains unique identifier of the policy evaluation and can be used to later retrieve the results from Cache.
                                example: Quos saepe dolorum qui tenetur aut.
                            example: Ipsam est alias officiis.
                    content:
                        application/json:
                            schema:
                                type: string
                                description: Arbitrary JSON response.
                                example: Tenetur rerum necessitatibus fugit.
                                format: binary
                            example: Qui dolores natus qui doloremque voluptatem.
    /policy/{repository}/{group}/{policyName}/{version}/evaluation/did.json:
        get:
            tags:
                - policy
            summary: Evaluate policy
            description: Evaluate executes a policy with the given 'data' as input.
            operationId: policy#Evaluate
            parameters:
                - name: repository
                  in: path
                  description: Policy repository.
                  required: true
                  schema:
                    type: string
                    description: Policy repository.
                    example: policies
                  example: policies
                - name: group
                  in: path
                  description: Policy group.
                  required: true
                  schema:
                    type: string
                    description: Policy group.
                    example: example
                  example: example
                - name: policyName
                  in: path
                  description: Policy name.
                  required: true
                  schema:
                    type: string
                    description: Policy name.
                    example: example
                  example: example
                - name: version
                  in: path
                  description: Policy version.
                  required: true
                  schema:
                    type: string
                    description: Policy version.
                    example: "1.0"
                  example: "1.0"
                - name: x-evaluation-id
                  in: header
                  description: EvaluationID allows overwriting the randomly generated evaluationID
                  allowEmptyValue: true
                  schema:
                    type: string
                    description: EvaluationID allows overwriting the randomly generated evaluationID
                    example: did:web:example.com
                  example: did:web:example.com
                - name: x-cache-ttl
                  in: header
                  description: Policy result cache TTL in seconds
                  allowEmptyValue: true
                  schema:
                    type: integer
                    description: Policy result cache TTL in seconds
                    example: 60
                    format: int64
                  example: 60
            requestBody:
                description: Input data passed to the policy execution runtime.
                required: true
                content:
                    application/json:
                        schema:
                            type: string
                            description: Input data passed to the policy execution runtime.
                            example: Rerum asperiores nulla.
                            format: binary
                        example: Molestiae fugiat harum quia corporis ullam natus.
            responses:
                "200":
                    description: OK response.
                    headers:
                        ETag:
                            description: ETag contains unique identifier of the policy evaluation and can be used to later retrieve the results from Cache.
                            required: true
                            schema:
                                type: string
                                description: ETag contains unique identifier of the policy evaluation and can be used to later retrieve the results from Cache.
                                example: Animi omnis minima fuga numquam.
                            example: Eius sed.
                    content:
                        application/json:
                            schema:
                                type: string
                                description: Arbitrary JSON response.
                                example: Tenetur rerum necessitatibus fugit.
                                format: binary
                            example: Rerum saepe dolores laborum odio.
    /policy/{repository}/{group}/{policyName}/{version}/lock:
        delete:
            tags:
                - policy
            summary: Unlock policy
            description: Unlock a policy so it can be evaluated again.
            operationId: policy#Unlock
            parameters:
                - name: repository
                  in: path
                  description: Policy repository.
                  required: true
                  schema:
                    type: string
                    description: Policy repository.
                    example: Accusamus dolores non temporibus est magni.
                  example: Earum quis odit eius saepe.
                - name: group
                  in: path
                  description: Policy group.
                  required: true
                  schema:
                    type: string
                    description: Policy group.
                    example: Delectus sit saepe dicta mollitia molestiae.
                  example: Deserunt blanditiis repudiandae quasi.
                - name: policyName
                  in: path
                  description: Policy name.
                  required: true
                  schema:
                    type: string
                    description: Policy name.
                    example: Ut unde pariatur velit esse.
                  example: Veniam repudiandae delectus facere est.
                - name: version
                  in: path
                  description: Policy version.
                  required: true
                  schema:
                    type: string
                    description: Policy version.
                    example: Commodi esse repellendus reiciendis molestias qui.
                  example: Nostrum animi omnis.
            responses:
                "200":
                    description: OK response.
        post:
            tags:
                - policy
            summary: Lock policy
            description: Lock a policy so that it cannot be evaluated.
            operationId: policy#Lock
            parameters:
                - name: repository
                  in: path
                  description: Policy repository.
                  required: true
                  schema:
                    type: string
                    description: Policy repository.
                    example: Omnis aut quas eos qui minima non.
                  example: Non consequuntur.
                - name: group
                  in: path
                  description: Policy group.
                  required: true
                  schema:
                    type: string
                    description: Policy group.
                    example: Aut in.
                  example: Et qui ut deleniti.
                - name: policyName
                  in: path
                  description: Policy name.
                  required: true
                  schema:
                    type: string
                    description: Policy name.
                    example: Eos cumque asperiores.
                  example: Commodi illo quidem omnis eveniet et.
                - name: version
                  in: path
                  description: Policy version.
                  required: true
                  schema:
                    type: string
                    description: Policy version.
                    example: Adipisci harum.
                  example: Ratione sit numquam non cupiditate sed omnis.
            responses:
                "200":
                    description: OK response.
    /readiness:
        get:
            tags:
                - health
            summary: Readiness health
            operationId: health#Readiness
            responses:
                "200":
                    description: OK response.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/HealthResponse'
                            example:
                                service: Vitae dolores quas et aperiam dolores reiciendis.
                                status: Voluptate amet.
                                version: Aut et.
    /v1/policies:
        get:
            tags:
                - policy
            summary: ListPolicies policy
            description: List policies from storage with optional filters.
            operationId: policy#ListPolicies
            parameters:
                - name: locked
                  in: query
                  description: Filter to return locked/unlocked policies (optional).
                  allowEmptyValue: true
                  schema:
                    type: boolean
                    description: Filter to return locked/unlocked policies (optional).
                    example: false
                  example: false
                - name: rego
                  in: query
                  description: Include policy source code in results (optional).
                  allowEmptyValue: true
                  schema:
                    type: boolean
                    description: Include policy source code in results (optional).
                    example: false
                  example: true
                - name: data
                  in: query
                  description: 'Include policy static data in results (optional). '
                  allowEmptyValue: true
                  schema:
                    type: boolean
                    description: 'Include policy static data in results (optional). '
                    example: true
                  example: false
                - name: dataConfig
                  in: query
                  description: Include static data config (optional).
                  allowEmptyValue: true
                  schema:
                    type: boolean
                    description: Include static data config (optional).
                    example: true
                  example: true
            responses:
                "200":
                    description: OK response.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/PoliciesResult'
                            example:
                                policies:
                                    - data: Voluptas ad corporis adipisci inventore ipsum.
                                      dataConfig: Recusandae dolorum nisi distinctio vitae ad.
                                      group: Accusamus enim.
                                      lastUpdate: 4303309286764032455
                                      locked: true
                                      policyName: Ut amet.
                                      rego: Quam dolores architecto itaque.
                                      repository: Reprehenderit in libero perspiciatis voluptatum ut soluta.
                                      version: Recusandae est rerum corrupti quia.
                                    - data: Voluptas ad corporis adipisci inventore ipsum.
                                      dataConfig: Recusandae dolorum nisi distinctio vitae ad.
                                      group: Accusamus enim.
                                      lastUpdate: 4303309286764032455
                                      locked: true
                                      policyName: Ut amet.
                                      rego: Quam dolores architecto itaque.
                                      repository: Reprehenderit in libero perspiciatis voluptatum ut soluta.
                                      version: Recusandae est rerum corrupti quia.
                                    - data: Voluptas ad corporis adipisci inventore ipsum.
                                      dataConfig: Recusandae dolorum nisi distinctio vitae ad.
                                      group: Accusamus enim.
                                      lastUpdate: 4303309286764032455
                                      locked: true
                                      policyName: Ut amet.
                                      rego: Quam dolores architecto itaque.
                                      repository: Reprehenderit in libero perspiciatis voluptatum ut soluta.
                                      version: Recusandae est rerum corrupti quia.
                                    - data: Voluptas ad corporis adipisci inventore ipsum.
                                      dataConfig: Recusandae dolorum nisi distinctio vitae ad.
                                      group: Accusamus enim.
                                      lastUpdate: 4303309286764032455
                                      locked: true
                                      policyName: Ut amet.
                                      rego: Quam dolores architecto itaque.
                                      repository: Reprehenderit in libero perspiciatis voluptatum ut soluta.
                                      version: Recusandae est rerum corrupti quia.
components:
    schemas:
        HealthResponse:
            type: object
            properties:
                service:
                    type: string
                    description: Service name.
                    example: Ea et ad omnis.
                status:
                    type: string
                    description: Status message.
                    example: Eveniet cupiditate qui quo.
                version:
                    type: string
                    description: Service runtime version.
                    example: Dignissimos enim.
            example:
                service: Error et sunt maxime aperiam.
                status: Et sit qui fugit enim labore.
                version: Et exercitationem perspiciatis quidem accusamus.
            required:
                - service
                - status
                - version
        PoliciesResult:
            type: object
            properties:
                policies:
                    type: array
                    items:
                        $ref: '#/components/schemas/Policy'
                    description: JSON array of policies.
                    example:
                        - data: Voluptas ad corporis adipisci inventore ipsum.
                          dataConfig: Recusandae dolorum nisi distinctio vitae ad.
                          group: Accusamus enim.
                          lastUpdate: 4303309286764032455
                          locked: true
                          policyName: Ut amet.
                          rego: Quam dolores architecto itaque.
                          repository: Reprehenderit in libero perspiciatis voluptatum ut soluta.
                          version: Recusandae est rerum corrupti quia.
                        - data: Voluptas ad corporis adipisci inventore ipsum.
                          dataConfig: Recusandae dolorum nisi distinctio vitae ad.
                          group: Accusamus enim.
                          lastUpdate: 4303309286764032455
                          locked: true
                          policyName: Ut amet.
                          rego: Quam dolores architecto itaque.
                          repository: Reprehenderit in libero perspiciatis voluptatum ut soluta.
                          version: Recusandae est rerum corrupti quia.
                        - data: Voluptas ad corporis adipisci inventore ipsum.
                          dataConfig: Recusandae dolorum nisi distinctio vitae ad.
                          group: Accusamus enim.
                          lastUpdate: 4303309286764032455
                          locked: true
                          policyName: Ut amet.
                          rego: Quam dolores architecto itaque.
                          repository: Reprehenderit in libero perspiciatis voluptatum ut soluta.
                          version: Recusandae est rerum corrupti quia.
            example:
                policies:
                    - data: Voluptas ad corporis adipisci inventore ipsum.
                      dataConfig: Recusandae dolorum nisi distinctio vitae ad.
                      group: Accusamus enim.
                      lastUpdate: 4303309286764032455
                      locked: true
                      policyName: Ut amet.
                      rego: Quam dolores architecto itaque.
                      repository: Reprehenderit in libero perspiciatis voluptatum ut soluta.
                      version: Recusandae est rerum corrupti quia.
                    - data: Voluptas ad corporis adipisci inventore ipsum.
                      dataConfig: Recusandae dolorum nisi distinctio vitae ad.
                      group: Accusamus enim.
                      lastUpdate: 4303309286764032455
                      locked: true
                      policyName: Ut amet.
                      rego: Quam dolores architecto itaque.
                      repository: Reprehenderit in libero perspiciatis voluptatum ut soluta.
                      version: Recusandae est rerum corrupti quia.
                    - data: Voluptas ad corporis adipisci inventore ipsum.
                      dataConfig: Recusandae dolorum nisi distinctio vitae ad.
                      group: Accusamus enim.
                      lastUpdate: 4303309286764032455
                      locked: true
                      policyName: Ut amet.
                      rego: Quam dolores architecto itaque.
                      repository: Reprehenderit in libero perspiciatis voluptatum ut soluta.
                      version: Recusandae est rerum corrupti quia.
                    - data: Voluptas ad corporis adipisci inventore ipsum.
                      dataConfig: Recusandae dolorum nisi distinctio vitae ad.
                      group: Accusamus enim.
                      lastUpdate: 4303309286764032455
                      locked: true
                      policyName: Ut amet.
                      rego: Quam dolores architecto itaque.
                      repository: Reprehenderit in libero perspiciatis voluptatum ut soluta.
                      version: Recusandae est rerum corrupti quia.
            required:
                - policies
        Policy:
            type: object
            properties:
                data:
                    type: string
                    description: Policy static data.
                    example: Dolorum cupiditate provident.
                dataConfig:
                    type: string
                    description: Policy static data optional configuration.
                    example: Dolor dolorem modi aut officiis veritatis impedit.
                group:
                    type: string
                    description: Policy group.
                    example: Laborum harum voluptate et ut similique doloremque.
                lastUpdate:
                    type: integer
                    description: Last update (Unix timestamp).
                    example: 1580298023389806623
                    format: int64
                locked:
                    type: boolean
                    description: Locked specifies if the policy is locked or allowed to execute.
                    example: false
                policyName:
                    type: string
                    description: Policy name.
                    example: Rem et occaecati quam.
                rego:
                    type: string
                    description: Policy rego source code.
                    example: Nisi et praesentium ut reiciendis.
                repository:
                    type: string
                    description: Policy repository.
                    example: Ut velit aut nobis repellendus.
                version:
                    type: string
                    description: Policy version.
                    example: Explicabo expedita ipsum minus ipsam at vel.
            example:
                data: Dolorem aut accusantium.
                dataConfig: Dolor culpa.
                group: Unde doloremque quae ullam.
                lastUpdate: 8514723213962082729
                locked: true
                policyName: Deserunt officiis ipsa molestiae.
                rego: Sapiente laborum.
                repository: In id quibusdam.
                version: Optio nobis iure rerum non.
            required:
                - repository
                - group
                - policyName
                - version
                - locked
                - lastUpdate
tags:
    - name: policy
      description: Policy Service provides evaluation of policies through Open Policy Agent.
    - name: health
      description: Health service provides health check endpoints.
