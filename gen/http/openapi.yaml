swagger: "2.0"
info:
    title: Policy Service
    description: The policy service exposes HTTP API for executing policies.
    version: ""
host: localhost:8081
consumes:
    - application/json
    - application/xml
    - application/gob
produces:
    - application/json
    - application/xml
    - application/gob
paths:
    /liveness:
        get:
            tags:
                - health
            summary: Liveness health
            operationId: health#Liveness
            responses:
                "200":
                    description: OK response.
                    schema:
                        $ref: '#/definitions/HealthLivenessResponseBody'
                        required:
                            - service
                            - status
                            - version
            schemes:
                - http
    /policy/{repository}/{group}/{policyName}/{version}/evaluation:
        get:
            tags:
                - policy
            summary: Evaluate policy
            description: Evaluate executes a policy with the given 'data' as input.
            operationId: policy#Evaluate#1
            parameters:
                - name: repository
                  in: path
                  description: Policy repository.
                  required: true
                  type: string
                - name: group
                  in: path
                  description: Policy group.
                  required: true
                  type: string
                - name: policyName
                  in: path
                  description: Policy name.
                  required: true
                  type: string
                - name: version
                  in: path
                  description: Policy version.
                  required: true
                  type: string
                - name: x-evaluation-id
                  in: header
                  description: EvaluationID allows overwriting the randomly generated evaluationID
                  required: false
                  type: string
                - name: x-cache-ttl
                  in: header
                  description: Policy result cache TTL in seconds
                  required: false
                  type: integer
                - name: any
                  in: body
                  description: Input data passed to the policy execution runtime.
                  required: true
                  schema:
                    type: string
                    format: binary
            responses:
                "200":
                    description: OK response.
                    schema:
                        type: string
                        format: binary
                    headers:
                        ETag:
                            description: ETag contains unique identifier of the policy evaluation and can be used to later retrieve the results from Cache.
                            type: string
            schemes:
                - http
        post:
            tags:
                - policy
            summary: Evaluate policy
            description: Evaluate executes a policy with the given 'data' as input.
            operationId: policy#Evaluate#2
            parameters:
                - name: repository
                  in: path
                  description: Policy repository.
                  required: true
                  type: string
                - name: group
                  in: path
                  description: Policy group.
                  required: true
                  type: string
                - name: policyName
                  in: path
                  description: Policy name.
                  required: true
                  type: string
                - name: version
                  in: path
                  description: Policy version.
                  required: true
                  type: string
                - name: x-evaluation-id
                  in: header
                  description: EvaluationID allows overwriting the randomly generated evaluationID
                  required: false
                  type: string
                - name: x-cache-ttl
                  in: header
                  description: Policy result cache TTL in seconds
                  required: false
                  type: integer
                - name: any
                  in: body
                  description: Input data passed to the policy execution runtime.
                  required: true
                  schema:
                    type: string
                    format: binary
            responses:
                "200":
                    description: OK response.
                    schema:
                        type: string
                        format: binary
                    headers:
                        ETag:
                            description: ETag contains unique identifier of the policy evaluation and can be used to later retrieve the results from Cache.
                            type: string
            schemes:
                - http
    /policy/{repository}/{group}/{policyName}/{version}/evaluation/did.json:
        get:
            tags:
                - policy
            summary: Evaluate policy
            description: Evaluate executes a policy with the given 'data' as input.
            operationId: policy#Evaluate
            parameters:
                - name: repository
                  in: path
                  description: Policy repository.
                  required: true
                  type: string
                - name: group
                  in: path
                  description: Policy group.
                  required: true
                  type: string
                - name: policyName
                  in: path
                  description: Policy name.
                  required: true
                  type: string
                - name: version
                  in: path
                  description: Policy version.
                  required: true
                  type: string
                - name: x-evaluation-id
                  in: header
                  description: EvaluationID allows overwriting the randomly generated evaluationID
                  required: false
                  type: string
                - name: x-cache-ttl
                  in: header
                  description: Policy result cache TTL in seconds
                  required: false
                  type: integer
                - name: any
                  in: body
                  description: Input data passed to the policy execution runtime.
                  required: true
                  schema:
                    type: string
                    format: binary
            responses:
                "200":
                    description: OK response.
                    schema:
                        type: string
                        format: binary
                    headers:
                        ETag:
                            description: ETag contains unique identifier of the policy evaluation and can be used to later retrieve the results from Cache.
                            type: string
            schemes:
                - http
    /policy/{repository}/{group}/{policyName}/{version}/lock:
        post:
            tags:
                - policy
            summary: Lock policy
            description: Lock a policy so that it cannot be evaluated.
            operationId: policy#Lock
            parameters:
                - name: repository
                  in: path
                  description: Policy repository.
                  required: true
                  type: string
                - name: group
                  in: path
                  description: Policy group.
                  required: true
                  type: string
                - name: policyName
                  in: path
                  description: Policy name.
                  required: true
                  type: string
                - name: version
                  in: path
                  description: Policy version.
                  required: true
                  type: string
            responses:
                "200":
                    description: OK response.
            schemes:
                - http
        delete:
            tags:
                - policy
            summary: Unlock policy
            description: Unlock a policy so it can be evaluated again.
            operationId: policy#Unlock
            parameters:
                - name: repository
                  in: path
                  description: Policy repository.
                  required: true
                  type: string
                - name: group
                  in: path
                  description: Policy group.
                  required: true
                  type: string
                - name: policyName
                  in: path
                  description: Policy name.
                  required: true
                  type: string
                - name: version
                  in: path
                  description: Policy version.
                  required: true
                  type: string
            responses:
                "200":
                    description: OK response.
            schemes:
                - http
    /readiness:
        get:
            tags:
                - health
            summary: Readiness health
            operationId: health#Readiness
            responses:
                "200":
                    description: OK response.
                    schema:
                        $ref: '#/definitions/HealthReadinessResponseBody'
                        required:
                            - service
                            - status
                            - version
            schemes:
                - http
    /v1/policies:
        get:
            tags:
                - policy
            summary: ListPolicies policy
            description: List policies from storage with optional filters.
            operationId: policy#ListPolicies
            parameters:
                - name: locked
                  in: query
                  description: Filter to return locked/unlocked policies (optional).
                  required: false
                  type: boolean
                - name: rego
                  in: query
                  description: Include policy source code in results (optional).
                  required: false
                  type: boolean
                - name: data
                  in: query
                  description: 'Include policy static data in results (optional). '
                  required: false
                  type: boolean
                - name: dataConfig
                  in: query
                  description: Include static data config (optional).
                  required: false
                  type: boolean
            responses:
                "200":
                    description: OK response.
                    schema:
                        $ref: '#/definitions/PolicyListPoliciesResponseBody'
                        required:
                            - policies
            schemes:
                - http
definitions:
    HealthLivenessResponseBody:
        title: HealthLivenessResponseBody
        type: object
        properties:
            service:
                type: string
                description: Service name.
                example: Voluptatibus cupiditate ea repellat inventore.
            status:
                type: string
                description: Status message.
                example: Doloremque recusandae earum.
            version:
                type: string
                description: Service runtime version.
                example: Quis nisi.
        example:
            service: Iure fugiat sed sit dolores iusto ut.
            status: Et eaque.
            version: Et mollitia.
        required:
            - service
            - status
            - version
    HealthReadinessResponseBody:
        title: HealthReadinessResponseBody
        type: object
        properties:
            service:
                type: string
                description: Service name.
                example: Non quo ut molestias rerum sunt.
            status:
                type: string
                description: Status message.
                example: Omnis dolores totam voluptatem rerum.
            version:
                type: string
                description: Service runtime version.
                example: Architecto et enim omnis.
        example:
            service: Est impedit.
            status: Consequatur ut suscipit.
            version: Neque et sed modi accusantium.
        required:
            - service
            - status
            - version
    PolicyListPoliciesResponseBody:
        title: PolicyListPoliciesResponseBody
        type: object
        properties:
            policies:
                type: array
                items:
                    $ref: '#/definitions/PolicyResponseBody'
                description: JSON array of policies.
                example:
                    - data: Voluptas ad corporis adipisci inventore ipsum.
                      dataConfig: Recusandae dolorum nisi distinctio vitae ad.
                      group: Accusamus enim.
                      lastUpdate: 4303309286764032455
                      locked: true
                      policyName: Ut amet.
                      rego: Quam dolores architecto itaque.
                      repository: Reprehenderit in libero perspiciatis voluptatum ut soluta.
                      version: Recusandae est rerum corrupti quia.
                    - data: Voluptas ad corporis adipisci inventore ipsum.
                      dataConfig: Recusandae dolorum nisi distinctio vitae ad.
                      group: Accusamus enim.
                      lastUpdate: 4303309286764032455
                      locked: true
                      policyName: Ut amet.
                      rego: Quam dolores architecto itaque.
                      repository: Reprehenderit in libero perspiciatis voluptatum ut soluta.
                      version: Recusandae est rerum corrupti quia.
                    - data: Voluptas ad corporis adipisci inventore ipsum.
                      dataConfig: Recusandae dolorum nisi distinctio vitae ad.
                      group: Accusamus enim.
                      lastUpdate: 4303309286764032455
                      locked: true
                      policyName: Ut amet.
                      rego: Quam dolores architecto itaque.
                      repository: Reprehenderit in libero perspiciatis voluptatum ut soluta.
                      version: Recusandae est rerum corrupti quia.
        example:
            policies:
                - data: Voluptas ad corporis adipisci inventore ipsum.
                  dataConfig: Recusandae dolorum nisi distinctio vitae ad.
                  group: Accusamus enim.
                  lastUpdate: 4303309286764032455
                  locked: true
                  policyName: Ut amet.
                  rego: Quam dolores architecto itaque.
                  repository: Reprehenderit in libero perspiciatis voluptatum ut soluta.
                  version: Recusandae est rerum corrupti quia.
                - data: Voluptas ad corporis adipisci inventore ipsum.
                  dataConfig: Recusandae dolorum nisi distinctio vitae ad.
                  group: Accusamus enim.
                  lastUpdate: 4303309286764032455
                  locked: true
                  policyName: Ut amet.
                  rego: Quam dolores architecto itaque.
                  repository: Reprehenderit in libero perspiciatis voluptatum ut soluta.
                  version: Recusandae est rerum corrupti quia.
        required:
            - policies
    PolicyResponseBody:
        title: PolicyResponseBody
        type: object
        properties:
            data:
                type: string
                description: Policy static data.
                example: Aut asperiores.
            dataConfig:
                type: string
                description: Policy static data optional configuration.
                example: Vel dolores omnis molestiae tempora sed repellendus.
            group:
                type: string
                description: Policy group.
                example: Et dolores.
            lastUpdate:
                type: integer
                description: Last update (Unix timestamp).
                example: 8993739598055578473
                format: int64
            locked:
                type: boolean
                description: Locked specifies if the policy is locked or allowed to execute.
                example: false
            policyName:
                type: string
                description: Policy name.
                example: Veritatis quam qui nostrum eaque.
            rego:
                type: string
                description: Policy rego source code.
                example: Ipsa ad voluptatum maxime ut.
            repository:
                type: string
                description: Policy repository.
                example: Maiores et minus.
            version:
                type: string
                description: Policy version.
                example: Delectus rerum molestiae possimus cum laboriosam.
        example:
            data: Aperiam aut odio dolorum.
            dataConfig: Quae et et unde.
            group: Ea architecto iure est similique architecto id.
            lastUpdate: 2495518142683426670
            locked: false
            policyName: Consectetur rerum vel sunt.
            rego: At ut dolore.
            repository: Vel voluptate quasi delectus.
            version: Ut est ut molestias sint ipsam.
        required:
            - repository
            - group
            - policyName
            - version
            - locked
            - lastUpdate
